{% extends 'appstage/base.html' %}
{% load static %}

{% block title %}Détail de l'offre{% endblock %}

{% block main %}
<div class="container mt-4" style="max-width: 900px;">

    <!-- IMAGE DE L'OFFRE -->
    <div class="text-center mb-4">
        {% if offre.imageOffre %}
            <img src="{{ offre.imageOffre.url }}" class="img-fluid rounded shadow" style="max-height: 350px; object-fit: cover;">
        {% else %}
            <img src="{% static 'appstage/img/default_offer.jpg' %}" class="img-fluid rounded shadow" style="max-height: 350px; object-fit: cover;">
        {% endif %}
    </div>

    <!-- INFO PRINCIPALE -->
    <div class="card shadow-sm p-4">

        <h2 class="fw-bold">{{ offre.titreOffre }}</h2>

        <p class="text-muted">
            <i class="bi bi-building"></i> {{ offre.entrepriseOffre }}
        </p>

        <p class="text-secondary small">
            <i class="bi bi-calendar"></i> Publiée le {{ offre.dateDepotOffre|date:"d M Y" }}
        </p>

        <!-- STATUT AVEC BADGE -->
        <p>
            {% if offre.statutOffre == 'validee' %}
                <span class="badge bg-success">Validée</span>
            {% elif offre.statutOffre == 'refusee' %}
                <span class="badge bg-danger">Refusée</span>
            {% elif offre.statutOffre == 'attente' %}
                <span class="badge bg-warning text-dark">En attente</span>
            {% elif offre.statutOffre == 'cloturee' %}
                <span class="badge bg-secondary">Clôturée</span>
            {% endif %}
        </p>

        <hr>

        <!-- DESCRIPTION -->
        <h5 class="fw-bold">Description du stage</h5>
        <p>{{ offre.detailsOffre }}</p>

        <hr>

        <!-- MESSAGE (si déjà candidaté ou erreur) -->
        {% if message %}
            <div class="alert alert-warning mt-3">{{ message }}</div>
        {% endif %}

        <!-- BOUTON CANDIDATURE POUR ÉTUDIANT -->
        {% if request.user.is_authenticated and not request.user.is_staff and not request.user.is_superuser %}
            {% if offre.statutOffre == 'validee' %}
                <a href="/offres/{{ offre.IDOffre }}/candidater/" class="btn btn-primary btn-lg w-100 mt-3">
                    <i class="bi bi-send"></i> Candidater à cette offre
                </a>
            {% else %}
                <div class="alert alert-secondary mt-3">
                    Cette offre n’est pas disponible pour la candidature.
                </div>
            {% endif %}
        {% endif %}

    </div>
</div>



{% endblock %}
